# File: layer1_os.def
Bootstrap: docker
From: ubuntu:24.04

%help
    Einstein Toolkit Container --- Layer 1/3 --- Operating System
    This is a base image for scientific computing.
    It includes Ubuntu 24.04 with common compilers, libraries
    (MPI, HDF5, FFTW3, etc.), and a configured UTF-8 locale.

%labels
    Author(s)  Leo Werneck <wernecklr@gmail.com>
    Version    1.0

%post
    # Prevent interactive prompts during installation
    export DEBIAN_FRONTEND=noninteractive

    # Install all required system-level dependencies
    apt-get update && apt-get install -y --no-install-recommends \
        gcc               \
        g++               \
        git               \
        gfortran          \
        numactl           \
        patch             \
        perl              \
        python3           \
        python-is-python3 \
        python3-pip       \
        locales           \
        cmake             \
        make              \
        rsync             \
        curl              \
        pkg-config        \
        libyaml-cpp-dev   \
        rdma-core         \
        libibverbs-dev    \
        librdmacm-dev     \
        ibverbs-providers \
        libnl-3-dev       \
        libnl-route-3-dev 

    # Clean up apt cache to reduce image size
    rm -rf /var/lib/apt/lists/*

    # --- Locale Generation ---
    # Generate and configure the en_US.UTF-8 locale
    echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen
    locale-gen
    update-locale LANG=en_US.UTF-8

%environment
    # Set the locale environment for any container that uses this as a base
    export LANGUAGE=en_US.UTF-8
    export LANG=en_US.UTF-8
    export LC_ALL=en_US.UTF-8

    ####################
    # Export Compilers #
    ####################
    export CC=$(which gcc)
    export CXX=$(which g++)
    export FC=$(which gfortran)
    export F77=$(which gfortran)
    export F90=$(which gfortran)

